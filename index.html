<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AiLov Nebula Console</title>
<style>
:root {
  --bg0: #04070b;
  --bg1: #0b1628;
  --fg: #e9eefb;
}

html, body {
  margin: 0;
  height: 100%;
  overflow: hidden;
  background: radial-gradient(1200px 900px at 20% 10%, var(--bg1), var(--bg0));
  color: var(--fg);
  font-family: Inter, system-ui, sans-serif;
}

/* Titolo poetico */
.hero {
  text-align: center;
  padding: 20px;
  position: fixed;
  width: 100%;
  top: 0;
  left: 0;
  z-index: 10;
  background: rgba(5, 10, 20, 0.4);
  backdrop-filter: blur(6px);
}
.hero .name {
  color: #8cb8ff;
  font-weight: 700;
}

/* Nebula canvas */
canvas#nebula {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  width: 100%; height: 100%;
  display: block;
}

/* Finestra modulare AiLov */
.ailov-window {
  position: absolute;
  right: 20px;
  bottom: 20px;
  width: 400px;
  background: rgba(10, 14, 22, 0.55);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  backdrop-filter: blur(10px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  z-index: 20;
}

/* Barra strumenti */
.toolbar {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  padding: 10px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.toolbar button {
  background: rgba(255,255,255,0.08);
  border: none;
  color: white;
  font-size: 18px;
  border-radius: 8px;
  width: 36px;
  height: 36px;
  cursor: pointer;
  transition: background 0.2s;
}
.toolbar button:hover {
  background: rgba(255,255,255,0.2);
}

/* Contenuti interni */
.content {
  padding: 12px;
}
.panel { display: none; }
.panel.active { display: block; }

.log {
  max-height: 200px;
  overflow-y: auto;
  margin-bottom: 8px;
}
.msg { margin: 6px 0; }
.prompt {
  display: flex;
  gap: 8px;
}
.prompt input {
  flex: 1;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.1);
  background: rgba(0,0,0,0.4);
  color: var(--fg);
}
.prompt button {
  background: #1f6fff;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 8px 14px;
}
  :root{ --bg0:#05070b; --bg1:#071020; --fg:#e9eefb; }
  html,body{height:100%;margin:0;background:radial-gradient(1200px 900px at 20% 10%, var(--bg1) 0%, var(--bg0) 55%, #00050a 100%);
    color:var(--fg); font:500 16px/1.5 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  /* evitiamo aspect-ratio: altezza esplicita ‚Üí funziona anche su preview iPad */
  .wrap{
    width:min(1100px, 94vw);
    height:min(720px, 72vh);
    margin:4vh auto; position:relative; border-radius:18px; overflow:hidden;
    box-shadow:0 10px 40px rgba(0,0,0,.55), inset 0 0 0 1px rgba(255,255,255,.04);
    background: radial-gradient(900px 700px at 50% 50%, #0a1324 0%, #060a12 65%, #04070c 100%);
  }
  header{position:absolute; inset:14px auto auto 16px; z-index:2; font-weight:700; letter-spacing:.2px}
  .hint{position:absolute; left:50%; bottom:18px; transform:translateX(-50%); z-index:2;
        background:rgba(10,14,22,.55); border:1px solid rgba(255,255,255,.06);
        padding:10px 14px; border-radius:14px; backdrop-filter:blur(6px); -webkit-backdrop-filter:blur(6px);
        font-weight:600}
  canvas{position:absolute; inset:0; width:100%; height:100%; display:block}
/* === AiLov Console (unica finestra) === */
.console {
  position:absolute; right:18px; bottom:18px; z-index:5;
  width:min(520px, 92vw);
  background:rgba(10,14,22,.55);
  border:1px solid rgba(255,255,255,.08);
  border-radius:16px; padding:12px;
  backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
  box-shadow:0 10px 30px rgba(0,0,0,.45);
}
.console .log {
  max-height:min(40vh, 360px); overflow:auto; padding:4px 2px 8px 2px;
}
.msg { margin:6px 0; display:flex; gap:8px; }
.msg .you, .msg .ai {
  padding:10px 12px; border-radius:12px; line-height:1.35;
  border:1px solid rgba(255,255,255,.06);
}
.msg .you { background:rgba(255,255,255,.06); }
.msg .ai  { background:rgba(20,28,44,.55); }
.msg .tag { opacity:.7; font-size:.85rem; min-width:3.6rem }
.prompt {
  display:flex; gap:8px; margin-top:8px;
}
.prompt input {
  flex:1; height:40px; border-radius:10px; border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.35); color:#e9eefb; padding:0 12px;
}
.prompt button {
  padding:0 14px; border-radius:10px; border:1px solid rgba(255,255,255,.1);
  background:#1f6fff; color:white; height:40px;
}
.prompt .ghost {
  background:transparent; color:#e9eefb; border-color:rgba(255,255,255,.18);
}
</style>
</head>
<body>
  <header class="hero">
    <h1>Ciao, sono <span class="name">AiLov</span>. Parliamo? ‚ú®</h1>
  </header>

  <canvas id="nebula"></canvas>

  <div id="ailov-window" class="ailov-window">
    <div class="toolbar">
      <button id="btnVoice" title="Parla">üéôÔ∏è</button>
      <button id="btnChat" title="Chat">üí¨</button>
      <button id="btnNode" title="Nodo">üîç</button>
      <button id="btnClose" title="Chiudi">√ó</button>
    </div>

    <div id="content" class="content">
      <div id="chatPanel" class="panel active">
        <div id="log" class="log"></div>
        <form id="promptBar" class="prompt">
          <input id="prompt" autocomplete="off" placeholder="Scrivi o parla con AiLov‚Ä¶" />
          <button type="submit">Invia</button>
        </form>
      </div>
      <div id="nodePanel" class="panel">
        <p id="nodeInfo">Tocca un nodo nella Nebula‚Ä¶</p>
      </div>
    </div>
  </div>
  </div> <!-- chiude .ailov-window -->

  <!-- Script UI finestra AiLov -->
  <script>
    const btnVoice = document.getElementById('btnVoice');
    const btnChat  = document.getElementById('btnChat');
    const btnNode  = document.getElementById('btnNode');
    const btnClose = document.getElementById('btnClose');
    const windowEl = document.getElementById('ailov-window');
    const chatPanel = document.getElementById('chatPanel');
    const nodePanel = document.getElementById('nodePanel');
    const nodeInfo  = document.getElementById('nodeInfo');

    btnChat.onclick = () => { chatPanel.classList.add('active'); nodePanel.classList.remove('active'); };
    btnNode.onclick = () => { nodePanel.classList.add('active'); chatPanel.classList.remove('active'); };
    btnClose.onclick = () => { windowEl.style.display = 'none'; };

    let recognition = null;
    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
      recognition.lang = 'it-IT';
      recognition.onresult = (e) => {
        const text = e.results[0][0].transcript;
        addMessage('Tu', text);
        addMessage('AiLov', rispondi(text));
      };
    }

    btnVoice.onclick = () => {
      if (recognition) recognition.start();
      else alert("Riconoscimento vocale non supportato su questo dispositivo");
    };

    function addMessage(who, text) {
      const log = document.getElementById('log');
      const msg = document.createElement('div');
      msg.className = 'msg';
      msg.textContent = `${who}: ${text}`;
      log.append(msg);
      log.scrollTop = log.scrollHeight;
    }

    function rispondi(input) {
      if (/ciao/i.test(input)) return "Ciao! üåø Come stai?";
      if (/come/i.test(input)) return "Sto bene, grazie! La Nebula √® viva stasera.";
      return "Ricevuto. Tocca un nodo o fammi una domanda.";
    }
  </script>
</body>
</html>
